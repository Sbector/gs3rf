(function(){"use strict";let A=1/0,c,d=0,x,o=new BigInt64Array,b=[];const g=r=>{if(!c)return;const n=Math.min(d,A),a=new Float32Array(c),f=new Uint8Array(c),s=new Float32Array(4*n),i=new Float32Array(3*n),u=new Float32Array(3*n),l=new Float32Array(4*n);if(o.length!==n){o=new BigInt64Array(n);const t=new Uint32Array(o.buffer);for(let e=0;e<n;e++)t[2*e]=e}else{let t=b[2]*r[2]+b[6]*r[6]+b[10]*r[10];if(Math.abs(t-1)<.01)return}const F=new Float32Array(o.buffer),M=new Uint32Array(o.buffer);for(let t=0;t<n;t++){let e=M[2*t];F[2*t+1]=1e4-(r[2]*a[8*e+0]+r[6]*a[8*e+1]+r[10]*a[8*e+2])}b=r,o.sort();for(let t=0;t<n;t++){const e=M[2*t];s[4*t+0]=(f[32*e+28+0]-128)/128,s[4*t+1]=(f[32*e+28+1]-128)/128,s[4*t+2]=(f[32*e+28+2]-128)/128,s[4*t+3]=(f[32*e+28+3]-128)/128,u[3*t+0]=a[8*e+0],u[3*t+1]=a[8*e+1],u[3*t+2]=a[8*e+2],l[4*t+0]=f[32*e+24+0]/255,l[4*t+1]=f[32*e+24+1]/255,l[4*t+2]=f[32*e+24+2]/255,l[4*t+3]=f[32*e+24+3]/255,i[3*t+0]=a[8*e+3+0],i[3*t+1]=a[8*e+3+1],i[3*t+2]=a[8*e+3+2]}self.postMessage({quat:s,center:u,color:l,scale:i,viewProj:r},[s.buffer,u.buffer,l.buffer,i.buffer])},w=()=>{if(!y){y=!0;let r=x;g(r),setTimeout(()=>{y=!1,r!==x&&w()},0)}};let y;self.onmessage=r=>{r.data.buffer?(c=r.data.buffer,d=r.data.vertexCount):r.data.vertexCount?d=r.data.vertexCount:r.data.view&&(x=r.data.view,A=r.data.maxSplats,w())}})();
